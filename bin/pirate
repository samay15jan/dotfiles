#!/bin/bash
# Import the colors
. "${HOME}/.cache/wal/colors.sh"

read -p "Search: " query
lynx -dump -nonumbers -listonly https://thepiratebay.party/search/$query | grep --max-count=70 -v "https://thepiratebay.party/search/" > file.txt
sed -i '1,20d' file.txt
grep -v "https://thepiratebay.party/user/" file.txt > file2.txt; mv file2.txt file.txt 
grep -v "https://thepiratebay.party/browse/" file.txt > file2.txt; mv file2.txt file.txt
id=$(grep -E "https://thepiratebay.party/torrent/" file.txt | cut -d'/' -f6- | dmenu -l 10 -p Select -nb "$color0" -nf "$color15" -sb "$color1" -sf "$color15" )
magnet_link=$(grep -A1 "$id" file.txt)
qbittorrent $magnet_link
rm file.txt
